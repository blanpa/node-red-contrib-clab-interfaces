<!-- CompuLab Serial Config Node -->
<script type="text/javascript">
    RED.nodes.registerType('clab-serial-config', {
        category: 'config',
        defaults: {
            name: { value: '' },
            port: { value: 'backpanel', required: true },
            baudRate: { value: 115200 },
            dataBits: { value: 8 },
            stopBits: { value: 1 },
            parity: { value: 'none' },
            uartMode: { value: 'rs232' }
        },
        label: function() {
            return this.name || `Serial: ${this.port} @ ${this.baudRate}`;
        }
    });
</script>

<script type="text/html" data-template-name="clab-serial-config">
    <div class="form-row">
        <label for="node-config-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-config-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-config-input-port"><i class="fa fa-usb"></i> Port</label>
        <select id="node-config-input-port">
            <optgroup label="IOT-GATE-iMX8 / IMX8PLUS">
                <option value="backpanel">Backpanel RS485/RS232 (/dev/ttymxc2)</option>
                <option value="addon_rs232">Add-on RS232 (/dev/ttymxc1)</option>
                <option value="addon_rs485">Add-on RS485 (/dev/ttymxc3)</option>
            </optgroup>
            <optgroup label="IOT-DIN-IMX8PLUS">
                <option value="rs485">RS485 (/dev/ttymxc2)</option>
            </optgroup>
            <optgroup label="IOT-LINK (i.MX93)">
                <option value="rs485_a">RS485 A - FARS4 (/dev/ttyLP6)</option>
                <option value="rs485_b">RS485 B - FBRS4 (/dev/ttyLP4)</option>
            </optgroup>
            <optgroup label="IOT-GATE-RPi">
                <option value="rs485_0">RS485 0 (/dev/ttyAMA1)</option>
                <option value="rs485_1">RS485 1 (/dev/ttyAMA2)</option>
                <option value="rs485_2">RS485 2 (/dev/ttyAMA3)</option>
                <option value="rs485_3">RS485 3 (/dev/ttyAMA4)</option>
            </optgroup>
            <optgroup label="USB / Console">
                <option value="console">Console (/dev/ttyUSB0)</option>
                <option value="/dev/ttyUSB0">/dev/ttyUSB0</option>
                <option value="/dev/ttyUSB1">/dev/ttyUSB1</option>
            </optgroup>
        </select>
    </div>
    <div class="form-row">
        <label for="node-config-input-uartMode"><i class="fa fa-exchange"></i> UART Modus</label>
        <select id="node-config-input-uartMode">
            <option value="rs232">RS232</option>
            <option value="rs485">RS485</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-config-input-baudRate"><i class="fa fa-tachometer"></i> Baudrate</label>
        <select id="node-config-input-baudRate">
            <option value="9600">9600</option>
            <option value="19200">19200</option>
            <option value="38400">38400</option>
            <option value="57600">57600</option>
            <option value="115200">115200</option>
            <option value="230400">230400</option>
            <option value="460800">460800</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-config-input-dataBits"><i class="fa fa-bars"></i> Datenbits</label>
        <select id="node-config-input-dataBits">
            <option value="7">7</option>
            <option value="8">8</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-config-input-stopBits"><i class="fa fa-stop"></i> Stopbits</label>
        <select id="node-config-input-stopBits">
            <option value="1">1</option>
            <option value="2">2</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-config-input-parity"><i class="fa fa-check-square"></i> Parität</label>
        <select id="node-config-input-parity">
            <option value="none">Keine</option>
            <option value="even">Gerade (Even)</option>
            <option value="odd">Ungerade (Odd)</option>
        </select>
    </div>
</script>

<!-- CompuLab Serial In Node -->
<script type="text/javascript">
    RED.nodes.registerType('clab-serial-in', {
        category: 'CompuLab',
        color: '#6B8E9F',
        defaults: {
            name: { value: '' },
            serial: { value: '', type: 'clab-serial-config', required: true },
            outputFormat: { value: 'string' },
            delimiter: { value: '\\n' }
        },
        inputs: 0,
        outputs: 1,
        icon: 'icons/clab.svg',
        label: function() {
            return this.name || 'Serial In';
        },
        paletteLabel: 'Serial In',
        labelStyle: function() {
            return this.name ? 'node_label_italic' : '';
        }
    });
</script>

<script type="text/html" data-template-name="clab-serial-in">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-serial"><i class="fa fa-usb"></i> Serial Port</label>
        <input type="text" id="node-input-serial">
    </div>
    <div class="form-row">
        <label for="node-input-outputFormat"><i class="fa fa-file-text"></i> Ausgabeformat</label>
        <select id="node-input-outputFormat">
            <option value="string">String</option>
            <option value="buffer">Buffer</option>
            <option value="json">JSON (wenn möglich)</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-delimiter"><i class="fa fa-cut"></i> Trennzeichen</label>
        <input type="text" id="node-input-delimiter" placeholder="\n">
    </div>
</script>

<script type="text/html" data-help-name="clab-serial-in">
    <p>Empfängt Daten von einem seriellen Port (RS232/RS485).</p>
    
    <h3>Ausgabe</h3>
    <dl class="message-properties">
        <dt>payload <span class="property-type">string | buffer | object</span></dt>
        <dd>Die empfangenen Daten</dd>
        <dt>port <span class="property-type">string</span></dt>
        <dd>Der Port von dem die Daten kamen</dd>
        <dt>timestamp <span class="property-type">number</span></dt>
        <dd>Unix Timestamp</dd>
    </dl>
    
    <h3>Details</h3>
    <p>Dieser Node empfängt Daten vom konfigurierten seriellen Port.
    Die Daten können als String, Buffer oder JSON ausgegeben werden.</p>
    
    <p>Bei String-Ausgabe kann ein Trennzeichen definiert werden,
    bei dem die Nachricht aufgeteilt wird (z.B. \n für Zeilenumbruch).</p>
</script>

<!-- CompuLab Serial Out Node -->
<script type="text/javascript">
    RED.nodes.registerType('clab-serial-out', {
        category: 'CompuLab',
        color: '#6B8E9F',
        defaults: {
            name: { value: '' },
            serial: { value: '', type: 'clab-serial-config', required: true },
            appendNewline: { value: true }
        },
        inputs: 1,
        outputs: 0,
        icon: 'icons/clab.svg',
        align: 'right',
        label: function() {
            return this.name || 'Serial Out';
        },
        paletteLabel: 'Serial Out',
        labelStyle: function() {
            return this.name ? 'node_label_italic' : '';
        }
    });
</script>

<script type="text/html" data-template-name="clab-serial-out">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-serial"><i class="fa fa-usb"></i> Serial Port</label>
        <input type="text" id="node-input-serial">
    </div>
    <div class="form-row">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-appendNewline" style="width:auto; vertical-align:top">
        <label for="node-input-appendNewline" style="width:auto"> Zeilenumbruch anhängen</label>
    </div>
</script>

<script type="text/html" data-help-name="clab-serial-out">
    <p>Sendet Daten an einen seriellen Port (RS232/RS485).</p>
    
    <h3>Eingabe</h3>
    <dl class="message-properties">
        <dt>payload <span class="property-type">string | buffer | object</span></dt>
        <dd>Die zu sendenden Daten</dd>
    </dl>
    
    <h3>Details</h3>
    <p>Sendet die Payload an den konfigurierten seriellen Port.
    Strings werden in UTF-8 konvertiert, Objekte werden als JSON gesendet.</p>
</script>

<!-- CompuLab UART Mode Node -->
<script type="text/javascript">
    RED.nodes.registerType('clab-uart-mode', {
        category: 'CompuLab',
        color: '#6B8E9F',
        defaults: {
            name: { value: '' },
            mode: { value: 'rs232' }
        },
        inputs: 1,
        outputs: 1,
        icon: 'icons/clab.svg',
        label: function() {
            return this.name || `UART: ${this.mode.toUpperCase()}`;
        },
        paletteLabel: 'UART Mode',
        labelStyle: function() {
            return this.name ? 'node_label_italic' : '';
        }
    });
</script>

<script type="text/html" data-template-name="clab-uart-mode">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-mode"><i class="fa fa-exchange"></i> Modus</label>
        <select id="node-input-mode">
            <option value="rs232">RS232</option>
            <option value="rs485">RS485</option>
        </select>
    </div>
</script>

<script type="text/html" data-help-name="clab-uart-mode">
    <p>Setzt den UART-Modus des Backpanel-Ports (RS232 oder RS485).</p>
    
    <h3>Eingabe</h3>
    <dl class="message-properties">
        <dt class="optional">payload <span class="property-type">string</span></dt>
        <dd>"rs232" oder "rs485" - überschreibt den konfigurierten Modus</dd>
    </dl>
    
    <h3>Ausgabe</h3>
    <dl class="message-properties">
        <dt>payload <span class="property-type">object</span></dt>
        <dd>Ergebnis der Modus-Änderung</dd>
        <dt>mode <span class="property-type">string</span></dt>
        <dd>Der gesetzte Modus</dd>
    </dl>
    
    <h3>Details</h3>
    <p>Der IOT-GATE-iMX8 Backpanel-Port kann zwischen RS232 und RS485 
    umgeschaltet werden. Dieser Node steuert den GPIO, der den Modus wechselt.</p>
</script>
